<% if params[:commit] == "選択編集" %>
  <h1>ユーザー選択編集</h1>
  <p>
  <font color = "#006400"><b>以下のデータを一括編集します。編集したくないデータは、チェックを外してください。</b></font>
  </p>
  
<% else %>
  <h1>ユーザー選択削除</h1>
  <p>
  <font color = "#006400"><b>以下のデータを一括削除します。削除したくないデータは、チェックを外してください。</b></font>
  </p>

<% end %>



<%= form_tag('/users_select_edit_all') do %>

  <% if params[:commit] == "選択編集" %>
    <div class="field" style="float:left;">
      <%= label_tag :年 %> 
      <%=select_tag 'user[grade]',options_for_select({０:"0",１:"1",２:"2",３:"3"}, :selected => @users_default_class),:class => "select_grade" %>
    </div>

    <div class="field" style="float:left;">
      <%= label_tag :組 %> 
      <%=select_tag 'user[class_room]',options_for_select({０:"0",１:"1",２:"2",３:"3",４:"4"}),:class => "select_class_room" %>
    </div>

    <br>
    <div style="float:left;"><%=submit_tag "選択編集", onclick: "return isCheck()" %></div>

  <% else %>

    <%=submit_tag "選択削除",  data: { confirm: '本当に削除しますか？' },onclick: "return isCheck()" %>

  <% end %>

  <table border="1" width="100%">

    <div align="right">
      <%= link_to '戻る', users_path,class: "btn-users" %>
    </div>

    <thead>
    
      <tr>    
        <th></th>
        <th>年</th>
        <th>組</th>
        <th>名前</th>
        <th>性別</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <% @users.each do |user| %>
  
        <tr>
          <td width="5%" align="center"><%= check_box_tag "select_datas[#{ user.id }]", user.id, {:checked => "checked"},:class => "list" %></td>
          <td width="5%" align="center"><%= user.grade %></td>
          <td width="5%" align="center"><%= user.class_room %></td>
          <td width="40%" align="center"><%= user.name %></td>
          <td width="10%" align="center"><%= user.gender %></td>
          <td width="15%" align="center"><%= link_to '詳細', user,class: "btn-users" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>


<% end %>

<script type="text/javascript">
function isCheck() {
	var arr_checkBoxes = document.getElementsByClassName("list");
  var count = 0;
	var select_grade = document.getElementsByClassName("select_grade");
	var select_class_room = document.getElementsByClassName("select_class_room");
  var user_count = 0;
  var flg1 = false;
  var flg2 = false;
	for (var i = 0; i < arr_checkBoxes.length; i++) {
		if (arr_checkBoxes[i].checked) {
			count++;
		}
	}
  if (count > 0) {
		flg1 = true;
	} else {
		window.alert("項目を選択してください。");
		flg1 = false;
	}

  user_count = <%= User.where(grade: 2, class_room: 0).count %>

  if (user_count == 0) {
		flg2 = true;
	} else {
    result = window.confirm("選択したクラスに既に生徒が存在しますが、以下の生徒を追加してもよろしいですか？");
    if (result) {
      flg2 = true;
    } else {
      flg2 = false;
    } 
  }
  

  if (flg1 && flg2){
    return true;
  } else {
    return false;
  }
}
</script>


